<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | Bus Tracker</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
/* Reset and Base Styles */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #1D1E2C, #282C3A);
    color: #fff;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
}
.dashboard {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(15px);
    padding: 40px 30px;
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    max-width: 800px;
    width: 100%;
    transition: transform 0.3s;
}
/* Headings and Paragraphs */
h1 { font-size: 26px; margin-bottom: 10px; font-weight: 600; text-align: center; }
p { font-size: 15px; color: #ccc; margin-bottom: 30px; text-align: center; }
h2 { font-size: 20px; margin-top: 25px; margin-bottom: 10px; font-weight: 500; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 5px; }

/* Form Styles */
form { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
#searchForm { border-bottom: none; } /* Remove border for the last form */

input, select, textarea {
    padding: 12px 15px;
    border-radius: 12px;
    border: none;
    font-size: 14px;
    background: rgba(255,255,255,0.1);
    color: #fff;
    flex: 1 1 calc(50% - 7.5px); /* Adjusted for 15px gap */
}
option{
  color: #1D1E2C;
}
input::placeholder, textarea::placeholder { color: #ddd; }
input:focus, select:focus, textarea:focus { outline: none; background: rgba(255,255,255,0.2); }
textarea { resize: vertical; flex-basis: 100%; }

/* Button Styles */
button {
    padding: 12px 20px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(90deg, #00c9a7, #00a688);
    font-weight: 600;
    font-size: 15px;
    color: #111;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    flex-basis: 100%;
}
button i { font-size: 16px; }
button:hover { background: linear-gradient(90deg, #00a688, #008f7a); }

/* Table Styles */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    overflow-x: auto; /* For small screens */
    display: block;
}
th, td {
    padding: 10px;
    border: 1px solid rgba(255, 255, 255, 0.3); /* Lighter border */
    text-align: left;
    font-size: 14px;
}
th { background: rgba(255,255,255,0.2); }

/* Message Styles */
.message {
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 10px;
    font-weight: 600;
    text-align: center;
}
.message.success { color: #00c9a7; background: rgba(0, 201, 167, 0.1); }
.message.error { color: #ff4d4d; background: rgba(255, 77, 77, 0.1); }

/* Search Result Styles */
#searchResult {
    margin-top: 10px;
    padding: 15px;
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    font-size: 14px;
    border-left: 5px solid #00c9a7;
}
.search-card {
    line-height: 1.6;
}
.search-card strong {
    color: #00c9a7;
}

/* Media Queries */
@media (max-width: 600px) {
    form { flex-direction: column; }
    input, select, textarea, button { flex: 1 1 100%; }
    .dashboard { padding: 20px 15px; }
}
</style>
</head>
<body onload="fetchAllStudents()">

<div class="dashboard">
    <h1>Admin Dashboard üë©‚Äçüíº</h1>
    <p>Manage students and monitor college bus users efficiently.</p>

    <div id="message" class="message" style="display:none;"></div>

    <h2>Add New Student</h2>
    <form id="addForm" action="AddStudentServlet" method="POST">
        <input type="text" name="name" placeholder="Student Name" required>
        <input type="text" name="roll_no" placeholder="Roll Number" required>
        <select name="branch" required>
            <option value="">Select Branch</option>
            <option value="CSE">CSE</option>
            <option value="ECE">ECE</option>
            <option value="EEE">EEE</option>
            <option value="MECH">MECH</option>
            <option value="CIVIL">CIVIL</option>
            <option value="IT">IT</option>
            <option value="OTHER">Other</option>
        </select>
        <select name="year_of_study" required>
            <option value="">Year of Study</option>
            <option value="1st Year">1st Year</option>
            <option value="2nd Year">2nd Year</option>
            <option value="3rd Year">3rd Year</option>
            <option value="4th Year">4th Year</option>
        </select>
        <input type="text" name="bus_route" placeholder="Bus Route" required>
        <input type="tel" name="phone" placeholder="Phone Number" pattern="[0-9]{10}" maxlength="10" required>
        <input type="email" name="email" placeholder="Email ID" required>
        <button type="submit"><i class="fas fa-plus"></i> Add Student</button>
    </form>

    <h2>Delete Student</h2>
    <form id="deleteForm" action="DeleteStudentServlet" method="POST">
        <input type="text" name="roll_no" placeholder="Roll Number to Delete" required style="flex-basis: calc(100% - 15px);">
        <button type="submit"><i class="fas fa-trash"></i> Delete Student</button>
    </form>

    <h2>Search Student</h2>
    <form id="searchForm" action="SearchStudentServlet" method="GET">
        <input type="text" name="roll_no" placeholder="Roll Number to Search" required style="flex-basis: calc(100% - 15px);">
        <button type="submit"><i class="fas fa-search"></i> Search Student</button>
    </form>
    <div id="searchResult" style="margin-bottom:15px; display:none;"></div>

    <h2>All Students List</h2>
    <table>
        <thead>
            <tr>
                <th>Roll No</th>
                <th>Name</th>
                <th>Branch</th>
                <th>Year</th>
                <th>Bus Route</th>
                <th>Phone</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody id="studentTable">
            </tbody>
    </table>
</div>

<script>
// Display messages
function showMessage(msg, type="success") {
    const message = document.getElementById('message');
    message.textContent = msg;
    message.className = `message ${type}`;
    message.style.display = 'block';
    setTimeout(()=>{
        message.textContent='';
        message.style.display = 'none';
    }, 4000);
}

// Fetch all students
function fetchAllStudents() {
    fetch('AllStudentsServlet')
    .then(res => res.json())
    .then(data => {
        const table = document.getElementById('studentTable');
        table.innerHTML = '';
        if (data.length === 0) {
            table.innerHTML = '<tr><td colspan="7" style="text-align:center; color:#ccc;">No students found in the database.</td></tr>';
            return;
        }
        data.forEach(s => {
            table.innerHTML += `<tr>
                <td>${s.roll_no}</td>
                <td>${s.name}</td>
                <td>${s.branch}</td>
                <td>${s.year_of_study}</td>
                <td>${s.bus_route}</td>
                <td>${s.phone}</td>
                <td>${s.email}</td>
            </tr>`;
        });
    })
    .catch(err => showMessage("Could not fetch student list.", "error"));
}

// Add Student
document.getElementById('addForm').addEventListener('submit', function(e){
    e.preventDefault();
    const formData = new FormData(this);
    fetch('AddStudentServlet', {method:'POST', body:new URLSearchParams(formData)}) // Use URLSearchParams for simple POST data
    .then(res=>res.text())
    .then(res=>{
        if(res.trim().toLowerCase().startsWith("success")) {
            showMessage("Student added successfully!", "success");
            fetchAllStudents();
            this.reset();
        } else {
            showMessage(res.trim() || "Failed to add student.", "error");
        }
    }).catch(err=>showMessage("An error occurred while adding student.", "error"));
});

// Delete Student
document.getElementById('deleteForm').addEventListener('submit', function(e){
    e.preventDefault();
    const formData = new FormData(this);
    fetch('DeleteStudentServlet', {method:'POST', body:new URLSearchParams(formData)})
    .then(res=>res.text())
    .then(res=>{
        if(res.trim().toLowerCase().startsWith("success")) {
            showMessage("Student deleted successfully!", "success");
            fetchAllStudents();
            this.reset();
        } else {
            showMessage(res.trim() || "Failed to delete student.", "error");
        }
    }).catch(err=>showMessage("An error occurred while deleting student.", "error"));
});

// Search Student
document.getElementById('searchForm').addEventListener('submit', function(e){
    e.preventDefault();
    const roll_no = this.roll_no.value.trim();
    const searchResultDiv = document.getElementById('searchResult');
    searchResultDiv.style.display = 'none';

    fetch(`SearchStudentServlet?roll_no=${roll_no}`)
    .then(res => {
        // Check if the response is JSON (a found student) or text (not found/error)
        const contentType = res.headers.get("content-type");
        if (contentType && contentType.indexOf("application/json") !== -1) {
            return res.json().then(data => {
                if (data && data.roll_no) { // Student found
                    searchResultDiv.innerHTML = `
                        <div class="search-card">
                            <strong>Found Student:</strong>
                            <br>Name: ${data.name}
                            <br>Roll No: ${data.roll_no}
                            <br>Branch: ${data.branch}
                            <br>Year: ${data.year_of_study}
                            <br>Bus Route: ${data.bus_route}
                            <br>Phone: ${data.phone}
                            <br>Email: ${data.email}
                        </div>
                    `;
                    searchResultDiv.style.display = 'block';
                    showMessage("Student found.", "success");
                } else { // Handle empty JSON or malformed success response
                    searchResultDiv.innerHTML = 'Student not found with this Roll Number.';
                    searchResultDiv.style.display = 'block';
                    showMessage("Student not found.", "error");
                }
            });
        } else {
            // Handle plain text response (likely an error or "not found" from servlet)
            return res.text().then(text => {
                searchResultDiv.innerHTML = text.trim() || 'Student not found with this Roll Number.';
                searchResultDiv.style.display = 'block';
                showMessage(text.trim() || "Student not found.", "error");
            });
        }
    })
    .catch(err => {
        searchResultDiv.innerHTML = 'An error occurred during search.';
        searchResultDiv.style.display = 'block';
        showMessage("Error searching for student.", "error");
    });
});

// Initial call to populate the table on load
window.onload = function() {
    fetchAllStudents();
};
</script>

</body>
</html>